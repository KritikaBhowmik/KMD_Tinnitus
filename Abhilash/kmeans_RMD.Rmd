---
title: "KMD_Abhilash"
author: "Abhilash"
date: "6/1/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

```{r}


library(dplyr)
library(tidyverse)
library(factoextra)
library(fpc)
library(RcmdrMisc)
library(ggplot2)

scaled_df <- scale(df)
#colMeans(scaled_df)
#summary(scaled_df)


#scaled_df <- as.data.frame(scale(df))

```

## Matrix vs Dataframe
https://www.burns-stat.com/documents/tutorials/impatient-r/#keyobjects
Atomic types: Numeric, Character, logical, factor

Matrices are of same atomic type, whereas Dataframe can have multiple atomic types in it.
Matrix rows are vector, Dataframe rows are Dataframe(i.e. List).

https://www.r-bloggers.com/matrix-vs-data-frame-in-r/ - x must be numeric error


```{r}


#Silhoutte Plot for Elbow method
fviz_nbclust(scaled_df, kmeans, method = "silhouette", k.max = 8)


```

```{r}

#https://www.guru99.com/r-k-means-clustering.html 


set.seed(123)
#Within group SS plot to see how the variations occur with different K values. 
kmclust_withinss <- function(k){
  kmclust <- kmeans(scaled_df,k,nstart=50,iter.max = 10 )
  return(kmclust$tot.withinss)
}

# Set maximum cluster 
max_k <-12 
# Run algorithm over a range of k 
wss <- sapply(1:max_k, kmclust_withinss)
wss

wss
plot(1:max_k, wss,
     type="b", pch = 19, frame = FALSE, 
     xlab="Number of clusters K",
     ylab="Total within-clusters sum of squares")

```


```{r}

#https://bookdown.org/rdpeng/exdata/k-means-clustering.html 

library(RColorBrewer)
library(gplots) #heatmap.2

set.seed(123)
kcenters <- c(2,4,7,11)

#par(mfrow = c(1, 2)) #For 2 plots side by side

image(t(scaled_df)[, nrow(scaled_df):1],col = hcl.colors(5, "Spectral", rev = TRUE), yaxt = "n", ylab = "row  order",xlab = "Heatmap values of rows", main = paste("Original Data"))


hmcols<- colorRampPalette(brewer.pal(9,"GnBu"))(100)


for(k in kcenters){

  set.seed(123)
  kmclust <- kmeans(scaled_df,k, 10)
  #image(t(scaled_df)[, order(kmclust$cluster)], yaxt = "n", main = paste("Clustered Data k=",k))
  image(t(scaled_df)[, order(kmclust$cluster)], col = hcl.colors(5, "Spectral", rev = TRUE), yaxt = "n", ylab = "row  order",xlab = "Heatmap values of rows", main = paste("Clustered Data k=",k))


#heatmap.2(scaled_df, kmclust, col=hmcols, trace= "none", main = paste("Clustered Data k=",k))

}

```


```{r}


#HEATMAP to highlight difference between feature values wrt each cluster

library(tidyr)

#conda install -c r r-rcolorbrewer : in cmd
library(RColorBrewer)
    

set.seed(123)
kcenters <- c(3,4,7,11)

for (k in kcenters){

    kmclust <- kmeans(scaled_df,k,nstart=50,iter.max = 10)
      
    #centers
    center <- kmclust$centers
    
    # create dataset with the cluster number
    
    cluster <- c(1:k)
    center_df <- data.frame(cluster, center)
    
    # Reshape the data
    
    center_reshape <- gather(center_df, features, values, .jour_nr: tlq_tlq02_4)
    #head(center_reshape)
      
    # Create the palette
    hm.palette <-colorRampPalette(rev(brewer.pal(10, 'RdYlGn')),space='Lab')
    
    #Plot the heat map
    ggplot(data = center_reshape, aes(x = features, y = cluster, fill = values)) +
      scale_y_continuous(breaks = seq(1, k, by = 1)) +
      geom_tile() +
      coord_equal() +
      scale_fill_gradientn(colours = hm.palette(90)) +
      theme_classic()
}

```

```{r}
#https://rpkgs.datanovia.com/factoextra/reference/fviz_cluster.html

km <- kmeans(scaled_df,4, nstart=50,iter.max = 15)
fviz_cluster(km, scaled_df, frame.type = "norm", frame.level = 0.68)

fviz_cluster(kmclust, scaled_df, frame.type = "norm", frame.level = 0.68)

```

```{r}

library(fpc)

#Bootstrapping

km.boot <- clusterboot(scaled_df, B=20, bootmethod="boot",
                       clustermethod=kmeansCBI,
                       krange=10, seed=123)





set.seed(123)
#Within group SS plot to see how the variations occur with different K values. 
kmclust_withinss <- function(k){
km.boot <- clusterboot(scaled_df, B=20, bootmethod="boot",
                       clustermethod=kmeansCBI,
                       krange=k, seed=1455)
  return(km.boot$result$result$tot.withinss)
}

# Set maximum cluster 
max_k <-12 
# Run algorithm over a range of k 
wss.boot <- sapply(2:max_k, kmclust_withinss)

wss
plot(2:max_k, wss.boot,
     type="b", pch = 19, frame = FALSE, 
     xlab="Number of clusters K",
     ylab="Total within-clusters sum of squares")

```

```{r}

library(boot)

y1 <- matrix( round(rnorm(25,5)), ncol=5)
y1
y1[2,1] 


y2 <- matrix( round(rnorm(40, 5)), ncol=5)
y2


bootsam <- lapply(1:nrow(y2), function(i){y2[sample(y2,ncol(y2), replace = T)]})
y2
bootsam1 <- matrix(unlist(bootsam), ncol = ncol(y2), byrow =TRUE)
bootsam1

bootsample <- lapply(1:nrow(scaled_df), function(i){scaled_df[sample(scaled_df, ncol(scaled_df), replace = T)]})
y2
bootsample1 <- matrix(unlist(bootsam), ncol = ncol(scaled_df), byrow =TRUE)
bootsample1



set.seed(123)
func <- function(data, i){
  
  d2 <- data[i,]
  
}

bootsample2 <- boot(scaled_df,func, R=10)
bootdata <- bootsample2$t0
bootdata1 <- bootsample2$t
bootdata11 <- bootsample2$t[1,]
bootdata111 <-  matrix(unlist(bootdata11), ncol = ncol(scaled_df), byrow =TRUE)

```



```{r}

#https://bookdown.org/rdpeng/exdata/k-means-clustering.html
#https://www.guru99.com/r-k-means-clustering.html
#https://www.researchgate.net/publication/230686580_A_Comprehensive_Subcellular_Proteomic_Survey_of_Salmonella_Grown_under_Phagosome-Mimicking_versus_Standard_Laboratory_Conditions/figures?lo=1
#https://www.google.com/search?q=z+score+in+kmeans&rlz=1C1CHBF_enIN765IN765&oq=z+score+in+kmeans&aqs=chrome..69i57j69i64.3175j0j4&sourceid=chrome&ie=UTF-8

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
